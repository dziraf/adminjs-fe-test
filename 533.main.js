"use strict";(self.webpackChunkrst_frame_app=self.webpackChunkrst_frame_app||[]).push([[533],{81102:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var r=n(13974);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const a=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"useToken",(function(e){var t=r.getToken();return t?e.headers.Authorization="Bearer ".concat(t):delete e.headers.Authorization,e})),s(this,"setToken",(function(e){r.token=JSON.parse(e),r.store.setItem(r.userTokenKey,e),r.runStatusListeners()})),s(this,"login",(function(t){var n=t.login,o=t.password,s=r.encodeData({client_id:r.clientId,username:n,password:o,grant_type:"password"});return r.ajax.post("".concat(r.urls.authServer,"/token"),s).then((function(e){var t=e.data;r.setToken(JSON.stringify(t))})).catch((function(t){throw r.logout(),new Error(e.getErrorMessage(t.response))}))})),s(this,"logout",(function(){r.store.removeItem(r.userTokenKey),r.token="",r.runStatusListeners()})),s(this,"refreshToken",(function(){var e=r.encodeData({refresh_token:r.getToken("refresh_token"),client_id:r.clientId,grant_type:"refresh_token"});return r.ajax.post("".concat(r.urls.authServer,"/token"),e).then((function(e){var t=e.data;r.setToken(JSON.stringify(t))})).catch((function(){r.logout()}))})),s(this,"encodeData",(function(e){return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")})),this.urls=n.data.urls,this.clientId=n.data.clientId,this.userTokenKey=n.data.userTokenKey,this.ajax=t.ajax,this.store=localStorage,this.ajax.axios.interceptors.request.use(this.useToken),this.listeners=new Set,this.token=""}var t,n,a;return t=e,n=[{key:"decodeToken",value:function(e){if("string"==typeof e){var t=e.split(".")[1];if(t)return JSON.parse(atob(t))}}},{key:"listenOnStatusChange",value:function(e){this.listeners.add(e)}},{key:"unlistenOnStatusChange",value:function(e){this.listeners.delete(e)}},{key:"runStatusListeners",value:function(){var e=this;this.listeners.forEach((function(t){return t(e.isLoggedIn())}))}},{key:"getToken",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"access_token";return this.token||(this.token=JSON.parse(this.store.getItem(this.userTokenKey))),(0,r.get)(this.token,e)}},{key:"getDecodedToken",value:function(){var e=this.getToken();return this.decodeToken(e)}},{key:"isLoggedIn",value:function(){return Boolean(this.getToken())}},{key:"getUserId",value:function(){var e=this.getDecodedToken();if(e)return e.userId}}],a=[{key:"getErrorMessage",value:function(e){var t=(0,r.get)(e,"data.error");return"User not exists"===t?"Niepoprawny login":"Invalid password"===t?"Nieprawidłowe hasło":"Account blocked"===t?"Konto jest zablokowane":"Błąd podczas logowania"}}],n&&o(t.prototype,n),a&&o(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}()}}]);